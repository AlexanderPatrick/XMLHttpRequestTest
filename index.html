<!DOCTYPE html>
<html>
	<head>
		<style>
			body { margin:0px; padding:0px; }
			input, textarea { width: 100%; }
			input[type="button"] { width:49%; }
		</style>
	</head>
	<body>
		<input id="timeout" type="number" placeholder="Timeout"/><br/>
		<input id="method" type="string" placeholder="Method"/><br/>
		<input id="host" type="string" placeholder="Host"/><br/>
		<input id="resource" type="string" placeholder="Resource"/><br/>
		<input id="data" type="string" placeholder="Data"/><br/>
		<input id="send" type="button" value="Send"/><input id="abort" type="button" value="Abort"/><br/>
		<p id="response"></p>
		<script>
			var xhr;
			window.addEventListener('load',init,false);
			//document.addEventListener('deviceready',init,false);
			function init() {
				alert('We ready.');
				xhr = new XMLHttpRequest();
				var response = document.getElementById('response');
				
				xhr.onreadystatechange = function () {
					response.innerHTML += 'Ready State: ' + xhr.readyState + '<br/>';
					if (xhr.readyState > 1) {
						response.innerHTML += 'Status: ' + xhr.status + ' ' + xhr.statusText + '<br/>';
						response.innerHTML += 'Headers: ' + xhr.getAllResponseHeaders() + '<br/>';
					}
					if (xhr.readyState == 4) {
						response.innerHTML += 'Response Type: ' + xhr.responseType + '<br/>';
						response.innerHTML += 'Response: ' + xhr.responseText + '<br/>';
					}
					response.innerHTML += '<br/>';
				};
				
				xhr.onabort = function () {
					response.innerHTML += 'Abort occurred.<br/>';
					getUserConfirmation('Request Aborted By User.','Abort');
				}
				
				xhr.onerror = function () {
					response.innerHTML += 'Error occurred.<br/>';
					getUserConfirmation('An error occurred.','Error');
				}
				
				xhr.ontimeout = function () {
					response.innerHTML += 'Timeout occurred.<br/>';
					getUserConfirmation('Request Timed Out.','Time Out');
				}
				
				document.getElementById('send').addEventListener('click',sendRequest,false);
				document.getElementById('abort').addEventListener('click',function() { xhr.abort(); },false);
			}
			
			function sendRequest() {
				var timeout = parseInt(document.getElementById('timeout').value);
				var method = document.getElementById('method').value.toUpperCase();
				var host = document.getElementById('host').value;
				var resource = document.getElementById('resource').value;
				var data = document.getElementById('data').value;
				
				var url = host + resource;
				if (method == 'GET') {
					url += '?' + data;
				}
				
				xhr.timeout = timeout;
				
				xhr.open(method,url,true);
				if (method == 'POST') {
					xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
					xhr.send(data);
				} else {
					xhr.send();
				}
			}
			
			function getUserConfirmation(message,title) {
				navigator.notification.confirm(message,function(button){if (button == 2) sendRequest();},title,'Okay,Retry');
			}
		</script>
	</body>
</html>