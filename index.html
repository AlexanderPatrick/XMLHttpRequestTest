<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
		<style>
			body { margin:0px; padding:0px; }
			input, textarea { width: 100%; }
			input[type="button"] { width:32%; }
		</style>
	</head>
	<body>
		<input id="timeout" type="number" placeholder="Timeout"/><br/>
		<input id="method" type="string" placeholder="Method"/><br/>
		<input id="host" type="string" placeholder="Host"/><br/>
		<input id="resource" type="string" placeholder="Resource"/><br/>
		<input id="data" type="string" placeholder="Data"/><br/>
		<input id="send" type="button" value="Send"/><input id="abort" type="button" value="Abort"/><input id="clear" type="button" value="Clear"/><br/>
		<div id="log"></div>
		<script type="text/javascript" src="phonegap.js"></script><!-- Required for deviceready to work. -->
		<script>
			var xhr;
			
			document.addEventListener('deviceready',init,false);
			function init() {
				xhr = new XMLHttpRequest();
				xhr.withCredentials = true;
				
				var logDiv = document.getElementById('log');
				logDiv.innerHTML += 'App Loaded.<br/><hr/><br/>';
				
				xhr.onreadystatechange = function () {
					var logString = '';
					switch (xhr.readyState) {
						case 0: logString += 'Ready State: 0 Unsent<br/>'; break;
						case 1: logString += 'Ready State: 1 Opened<br/>'; break;
						case 2: logString += 'Ready State: 2 Headers Received<br/>'; break;
						case 3: logString += 'Ready State: 3 Loading<br/>'; break;
						case 4: logString += 'Ready State: 4 Done<br/>'; break;
					}
					if (xhr.readyState == 2) {
						logString += 'Status: ' + xhr.status + ' ' + xhr.statusText + '<br/>';
						logString += 'Headers: ' + xhr.getAllResponseHeaders() + '<br/>';
					}
					if (xhr.readyState == 4) {
						logString += 'Response Type: ' + xhr.responseType + '<br/>';
						logString += 'Response: "' + xhr.responseText + '"<br/><hr/><br/>';
					}
					logDiv.innerHTML += logString;
				};
				
				xhr.onabort = function () {
					document.getElementById('log').innerHTML += 'Abort occurred.<br/>';
					getUserConfirmation('Request Aborted By User.','Abort');
				}
				
				xhr.onerror = function () {
					document.getElementById('log').innerHTML += 'Error occurred.<br/>';
					getUserConfirmation('An error occurred.','Error');
				}
				
				xhr.ontimeout = function () {
					document.getElementById('log').innerHTML += 'Timeout occurred.<br/>';
					getUserConfirmation('Request Timed Out.','Time Out');
				}
				
				document.getElementById('send').addEventListener('click',sendRequest,false);
				document.getElementById('abort').addEventListener('click',function() { xhr.abort(); },false);
				document.getElementById('clear').addEventListener('click',function() { document.getElementById('log').innerHTML = ''; },false);
			}
			
			function sendRequest() {
				var timeout = parseInt(document.getElementById('timeout').value);
				var method = document.getElementById('method').value.toUpperCase();
				var host = document.getElementById('host').value;
				var resource = document.getElementById('resource').value;
				var data = document.getElementById('data').value;
				
				var url = host + resource;
				if (method == 'GET' && data != '') {
					url += '?' + data;
				}
				
				xhr.timeout = timeout;
				
				xhr.open(method,url,true);
				if (method == 'POST') {
					xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
					xhr.send(data);
				} else {
					xhr.send();
				}
			}
			
			function getUserConfirmation(message,title) {
				navigator.notification.confirm(message,function(button){if (button == 2) sendRequest();},title,'Okay,Retry');
			}
		</script>
	</body>
</html>